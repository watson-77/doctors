=== Apicoder Doctors ===
Contributors: apicoder
Tags: doctors, medical, directory, physicians, specialists, city, specialization, filter, ajax, cmb2
Requires at least: 5.0
Tested up to: 6.9.1
Requires PHP: 7.4
Stable tag: 1.0.0
License: GPLv2 or later
License URI: https://www.gnu.org/licenses/gpl-2.0.html

Профессиональный плагин для создания каталога врачей с AJAX-фильтрацией по городам и специализациям, а также удобными метаполями на базе CMB2.

== Описание ==

Apicoder Doctors — это мощный плагин для WordPress, который позволяет организовать каталог врачей на вашем сайте. Плагин добавляет собственный тип записи «Врачи» (doctors) и две таксономии: «Город» (city) и «Специализация» (specialization). Для каждого врача можно указать стаж, стоимость приёма, рейтинг и фотографию.

**Ключевые возможности:**

*   Полноценный тип записи «Врачи» с поддержкой всех стандартных функций WordPress.
*   Таксономии «Город» и «Специализация» для точной классификации.
*   Дополнительные поля (стаж, цена, рейтинг) через CMB2 — удобно и гибко.
*   AJAX-фильтрация на странице архива врачей и на страницах таксономий без перезагрузки страницы.
*   Пагинация на архивных страницах.
*   Адаптивная вёрстка карточек врачей (на базе Bootstrap, но легко стилизуется под любую тему).
*   Состояние фильтров сохраняется в URL — можно делиться ссылками и пользоваться кнопками браузера «назад/вперёд».
*   Полная совместимость с произвольными темами — шаблоны можно переопределить.

Плагин протестирован с WordPress 6.9.1 и требует PHP 7.4 или выше.

== Установка ==

1. Загрузите папку `apicoder-doctors` в каталог `/wp-content/plugins/` или установите плагин через меню «Плагины» в административной панели WordPress.
2. Активируйте плагин через меню «Плагины».
3. После активации в меню появится новый пункт «Доктора» — там вы сможете добавлять и редактировать врачей.
4. Перейдите в «Доктора» → «Города» и «Доктора» → «Специализации», чтобы создать необходимые термины.
5. Убедитесь, что в настройках постоянных ссылок (Настройки → Постоянные ссылки) выбран любой вариант, кроме «Обычно», и нажмите «Сохранить изменения» (это обновит правила перезаписи).

== Использование ==

**Создание врача:**

1. Перейдите в «Доктора» → «Добавить нового врача».
2. Заполните заголовок (ФИО врача) и основной текст (описание).
3. В правой колонке выберите нужные города и специализации.
4. Загрузите миниатюру записи — это будет фото врача.
5. В метабоксе «Биография» укажите:
   * ФИО (если оно отличается от заголовка записи)
   * Стаж работы (в годах)
   * Цена от (в рублях)
   * Рейтинг (можно использовать десятичные дроби, например 8.5)
6. Опубликуйте запись.

**Фильтрация на сайте:**

На странице архива врачей (обычно `/doctors/`) и на страницах городов (например, `/city/moskva/`) отображаются выпадающие списки для фильтрации. При выборе города или специализации карточки врачей обновляются автоматически без перезагрузки страницы.

== Шорткоды ==

Плагин не использует шорткоды. Все данные выводятся через стандартные шаблоны WordPress.

== Шаблоны ==

Плагин содержит следующие шаблоны, которые можно переопределить в вашей теме:

*   `archive-doctors.php` — архив врачей (все записи).
*   `taxonomy-city.php` — архив записей для конкретного города.
*   `taxonomy-specialization.php` — архив записей для конкретной специализации.
*   `single-doctors.php` — страница отдельного врача.
*   `doctor-card.php` — карточка врача (используется в циклах и AJAX-ответах).

Чтобы переопределить шаблон, создайте в папке вашей темы подпапку `apicoder-doctors` и поместите туда файл с тем же именем. Например:
`wp-content/themes/ваша-тема/apicoder-doctors/doctor-card.php`

== Фильтры ==

На страницах архива и таксономий доступны следующие фильтры:

*   По городу (если не на странице города)
*   По специализации (если не на странице специализации)
*   Кнопка сброса фильтров (На странице списка всех докторов)

Фильтрация работает через AJAX и обновляет содержимое без перезагрузки.

== Демо-данные ==

В текущей версии плагин не включает автоматическую установку демо-данных. Вы можете создать тестовые записи вручную, используя стандартный интерфейс добавления врачей.

*Возможно, в будущих версиях появится мастер импорта демо-записей.*

== Часто задаваемые вопросы ==

= Как добавить фотографию врачу? =
Используйте стандартное поле «Миниатюра записи» в редакторе записи врача (обычно находится в правой колонке).

= Почему не работает AJAX‑фильтрация? =
Убедитесь, что:
* На странице присутствуют элементы с ID `city-filter`, `specialization-filter`, `doctors-container` и `loading-indicator`.
* Плагин подключён и активирован.
* В консоли браузера нет ошибок JavaScript.
* Nonce передаётся корректно (это автоматически делает плагин).

= Как изменить внешний вид карточек врачей? =
Скопируйте файл `doctor-card.php` из папки плагина в папку вашей темы (`ваша-тема/apicoder-doctors/doctor-card.php`) и отредактируйте его по своему усмотрению.

= Можно ли добавить новые поля для врачей? =
Да, вы можете использовать стандартные произвольные поля WordPress или подключить дополнительные плагины для метабоксов. Плагин уже использует CMB2, поэтому вы можете расширить метабокс «Биография» своими полями (потребуются навыки программирования).

= Плагин поддерживает мультиязычность? =
Да, все строки подготовлены для перевода с помощью функций WordPress. Используйте любой плагин перевода (например, Loco Translate) для создания файлов перевода.

== Обновления ==

= 1.0.0 =
* Первый стабильный релиз.
* Регистрация типа записи `doctors`.
* Таксономии `city` и `specialization`.
* Метаполя на базе CMB2 (стаж, цена, рейтинг, ФИО).
* AJAX-фильтрация на архивах.
* Пагинация.
* Адаптивные шаблоны.

== Перевод ==

Плагин готов к локализации. Текстовый домен: `apicoder`.

Файлы перевода можно разместить в:
`wp-content/languages/plugins/apicoder-ru_RU.mo`
`wp-content/languages/plugins/apicoder-ru_RU.po`

== Совместимость ==

* **WordPress:** 5.0 – 6.9.1
* **PHP:** 7.4 – 8.3
* **Темы:** совместим с любой темой, поддерживающей стандартные шаблоны WordPress.
* **Плагины:** не конфликтует с популярными плагинами (например, WooCommerce, Elementor). В случае проблем отключите другие плагины для проверки.

== Производительность ==

* Минимум дополнительных запросов к базе данных.
* Скрипты и стили подключаются только на нужных страницах.
* Кэширование результатов фильтрации на стороне браузера.
* Адаптивные изображения благодаря использованию стандартных размеров WordPress.

== Безопасность ==

* Все данные, получаемые из форм, проходят санитизацию и валидацию.
* AJAX‑запросы защищены nonce.
* Проверка прав доступа перед выполнением операций.
* Использование подготовленных запросов через WordPress API.

== Поддержка ==

Если у вас возникли вопросы или проблемы:

1. Прочтите этот файл и раздел «Часто задаваемые вопросы».
2. Убедитесь, что ваш WordPress и PHP обновлены до актуальных версий.
3. Временно отключите другие плагины и переключитесь на стандартную тему (например, Twenty Twenty‑Four), чтобы проверить, не вызван ли конфликт другим кодом.
4. Создайте тему на форуме поддержки WordPress (https://wordpress.org/support/plugin/apicoder-doctors) или обратитесь к разработчику напрямую.

== Разработчикам ==

Плагин предоставляет следующие хуки и функции для расширения:

**Фильтры:**
* `doctors_labels` — позволяет изменить метки типа записи.
* `doctors_args` — позволяет изменить аргументы регистрации типа записи.
* `doctors_taxonomy_city_args` — аргументы таксономии «Город».
* `doctors_taxonomy_specialization_args` — аргументы таксономии «Специализация».

**Полезные функции:**
* `apicoder_doctors_pagination()` — выводит пагинацию для архива врачей.
* `render_doctor_card($post_id)` — рендерит карточку врача (можно использовать в произвольных шаблонах).

**Константы:**
* `ADL_CORE_TEMPL` — путь к папке с шаблонами плагина.
* `PLUGIN_URL` — URL плагина (для подключения ресурсов).

== Благодарности ==

Благодарим всех, кто участвовал в тестировании и помогал с обратной связью. Особая благодарность разработчикам CMB2 за отличный инструмент для создания метабоксов.

== Лицензия ==

Apicoder Doctors распространяется под лицензией GPL v2 или позднее. Подробнее: https://www.gnu.org/licenses/gpl-2.0.html

== Автор ==

Разработано Apicoder (https://apicoder.ru)
